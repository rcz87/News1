<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Article Cards</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 8px; }
        .article-card { 
            border: 1px solid #ddd; 
            padding: 15px; 
            margin: 10px 0; 
            cursor: pointer; 
            border-radius: 8px;
            background: #f9f9f9;
        }
        .article-card:hover { background: #e9e9e9; }
        .error { color: red; font-weight: bold; }
        .success { color: green; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Debug Article Cards - Channel Context Issue</h1>
    
    <div class="test-section">
        <h2>Test 1: Direct API Test</h2>
        <div id="api-test"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 2: Simulated Article Cards</h2>
        <div id="simulated-cards"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 3: Channel Detection Test</h2>
        <div id="channel-test"></div>
    </div>

    <script>
        // Test 1: Direct API Test
        async function testAPI() {
            try {
                const response = await fetch('http://localhost:5000/api/channels/ambal/articles');
                const articles = await response.json();
                
                const container = document.getElementById('api-test');
                container.innerHTML = `
                    <div class="success">âœ“ API Working: Found ${articles.length} articles</div>
                    <div>First article: ${articles[0]?.title || 'None'}</div>
                    <div>First slug: ${articles[0]?.slug || 'None'}</div>
                `;
                
                // Test 2: Create simulated cards
                createSimulatedCards(articles.slice(0, 3));
                
            } catch (error) {
                document.getElementById('api-test').innerHTML = 
                    `<div class="error">âœ— API Failed: ${error.message}</div>`;
            }
        }
        
        // Test 2: Simulated Article Cards (without React context)
        function createSimulatedCards(articles) {
            const container = document.getElementById('simulated-cards');
            container.innerHTML = '<p>Simulated cards (should be clickable):</p>';
            
            articles.forEach((article, index) => {
                const card = document.createElement('div');
                card.className = 'article-card';
                card.innerHTML = `
                    <h3>${article.title}</h3>
                    <p><strong>Slug:</strong> ${article.slug}</p>
                    <p><strong>Channel:</strong> ambal</p>
                    <p><em>Click to test navigation to: /ambal/article/${article.slug}</em></p>
                `;
                
                card.addEventListener('click', function() {
                    const targetUrl = `/ambal/article/${article.slug}`;
                    console.log('ðŸ”— Simulated click:', article.slug, 'Target:', targetUrl);
                    
                    // Test if URL is accessible
                    testArticleURL(targetUrl, article.slug);
                });
                
                container.appendChild(card);
            });
        }
        
        // Test 3: Channel Detection
        async function testChannelDetection() {
            const container = document.getElementById('channel-test');
            
            // Test different paths
            const paths = ['/', '/ambal', '/ambal/article/test-slug'];
            
            for (const path of paths) {
                try {
                    const response = await fetch(`http://localhost:5000${path}`);
                    const status = response.status;
                    const statusText = status === 200 ? 'âœ“' : 'âœ—';
                    
                    container.innerHTML += `
                        <div>${statusText} ${path} - HTTP ${status}</div>
                    `;
                } catch (error) {
                    container.innerHTML += `
                        <div class="error">âœ— ${path} - Error: ${error.message}</div>
                    `;
                }
            }
        }
        
        // Test article URL accessibility
        async function testArticleURL(url, slug) {
            try {
                const response = await fetch(`http://localhost:5000${url}`);
                if (response.ok) {
                    alert(`âœ“ SUCCESS: Article "${slug}" is accessible at ${url}`);
                } else {
                    alert(`âœ— FAILED: Article "${slug}" returned HTTP ${response.status}`);
                }
            } catch (error) {
                alert(`âœ— ERROR: Article "${slug}" - ${error.message}`);
            }
        }
        
        // Run all tests
        testAPI();
        testChannelDetection();
        
        // Add explanation
        document.body.innerHTML += `
            <div class="test-section">
                <h2>Analysis</h2>
                <p><strong>If Test 1 passes but articles aren't clickable in the real app:</strong></p>
                <ul>
                    <li>The issue is likely in the React component (ArticleCard.tsx)</li>
                    <li>Possible cause: Channel context is null, causing ArticleCard to return null</li>
                    <li>Possible cause: Click handlers are not properly bound</li>
                    <li>Possible cause: CSS issues preventing clicks</li>
                </ul>
                <p><strong>If Test 2 cards work:</strong> The routing and URLs are correct, issue is in React component</p>
                <p><strong>If Test 3 shows issues:</strong> There's a server-side routing problem</p>
            </div>
        `;
    </script>
</body>
</html>

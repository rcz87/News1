<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Article Click</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .article-card { 
            border: 1px solid #ccc; 
            padding: 15px; 
            margin: 10px 0; 
            cursor: pointer; 
            border-radius: 8px;
            transition: background-color 0.2s;
        }
        .article-card:hover { 
            background-color: #f0f0f0; 
        }
        .test-result { 
            margin: 20px 0; 
            padding: 10px; 
            border-radius: 4px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>Test Article Click Functionality</h1>
    
    <div id="test-results"></div>
    
    <h2>Articles from Ambal Channel:</h2>
    <div id="articles-container"></div>

    <script>
        let testResults = [];
        
        function addTestResult(test, passed, message) {
            testResults.push({ test, passed, message });
            updateTestResults();
        }
        
        function updateTestResults() {
            const container = document.getElementById('test-results');
            container.innerHTML = testResults.map(result => 
                `<div class="test-result ${result.passed ? 'success' : 'error'}">
                    <strong>${result.test}:</strong> ${result.passed ? 'PASS' : 'FAIL'} - ${result.message}
                </div>`
            ).join('');
        }
        
        async function loadArticles() {
            try {
                const response = await fetch('http://localhost:5000/api/channels/ambal/articles');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const articles = await response.json();
                addTestResult('API Connection', true, `Successfully loaded ${articles.length} articles`);
                displayArticles(articles);
            } catch (error) {
                addTestResult('API Connection', false, error.message);
            }
        }
        
        function displayArticles(articles) {
            const container = document.getElementById('articles-container');
            
            articles.slice(0, 3).forEach((article, index) => {
                const card = document.createElement('div');
                card.className = 'article-card';
                card.innerHTML = `
                    <h3>${article.title}</h3>
                    <p><strong>Slug:</strong> ${article.slug}</p>
                    <p><strong>Category:</strong> ${article.category}</p>
                    <p><strong>Author:</strong> ${article.author}</p>
                    <p><em>Click this card to test navigation</em></p>
                `;
                
                card.addEventListener('click', function() {
                    const targetUrl = `/ambal/article/${article.slug}`;
                    console.log('ðŸ”— Clicked article:', article.slug, 'Target URL:', targetUrl);
                    
                    // Test if the URL would be accessible
                    testArticleUrl(targetUrl, article.slug);
                });
                
                container.appendChild(card);
            });
        }
        
        async function testArticleUrl(url, slug) {
            try {
                const response = await fetch(`http://localhost:5000${url}`);
                if (response.ok) {
                    addTestResult(`Article URL Test (${slug})`, true, `URL ${url} is accessible`);
                } else {
                    addTestResult(`Article URL Test (${slug})`, false, `URL ${url} returned ${response.status}`);
                }
            } catch (error) {
                addTestResult(`Article URL Test (${slug})`, false, `Error accessing ${url}: ${error.message}`);
            }
        }
        
        // Test basic routing
        async function testRouting() {
            try {
                const response = await fetch('http://localhost:5000/ambal');
                if (response.ok) {
                    addTestResult('Channel Homepage', true, '/ambal route is accessible');
                } else {
                    addTestResult('Channel Homepage', false, `/ambal returned ${response.status}`);
                }
            } catch (error) {
                addTestResult('Channel Homepage', false, `Error: ${error.message}`);
            }
        }
        
        // Run tests
        testRouting();
        loadArticles();
    </script>
</body>
</html>
